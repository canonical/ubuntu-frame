#!/bin/sh
set -eu

wait_for()
{
  until
    until
      inotifywait --event create "$(dirname "$1")"&
      inotify_pid=$!
      [ -e "$1" ] || sleep 2 && [ -e "$1" ]
    do
      wait "${inotify_pid}"
    done
    kill "${inotify_pid}"
    [ -O "$1" ]
  do
    sleep 1
  done
}

display_file="$SNAP_DATA/frame.display"

wait_for "${display_file}"

if [ -z "$(snapctl get display)" ] && ! grep "DO NOT EDIT THIS FILE BY HAND"  "${display_file}"
then
  snapctl set display="$(cat "${display_file}")"
fi
